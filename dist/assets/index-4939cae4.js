/* empty css             *//* empty css                        *//* empty css                  *//* empty css                   *//* empty css                      *//* empty css                 *//* empty css                  *//* empty css                   *//* empty css                *//* empty css                     */import{ad as v,d as re,a as u,r as S,P as de,ae as ie,o as f,e as O,f as l,w as t,i,g as T,M as V,z as _,v as M,x as j,B as ue,F as me,y as pe,af as U,m as ce,n as fe,p as ge,q as _e,aa as ve,ag as be,ah as we,ai as he,aj as Ce,ak as ye,al as Ve,am as Ie,s as Re,t as Ue,_ as Ee}from"./index-88a49f2b.js";import{u as ke}from"./setting-f523d10d.js";const xe=(r,b,w="")=>v.get(`/admin/acl/user/${r}/${b}/?username=${w}`),Le=r=>r.id?v.put("/admin/acl/user/update",r):v.post("/admin/acl/user/save",r),Se=r=>v.get("/admin/acl/user/toAssign/"+r),ze=r=>v.post("/admin/acl/user/doAssignRole",r),qe=r=>v.delete("/admin/acl/user/remove/"+r),$e=r=>v.delete("/admin/acl/user/batchRemove",{data:r}),De=r=>(Re("data-v-180e4465"),r=r(),Ue(),r),Ne=De(()=>M("h1",null,"分配角色",-1)),Be={name:"user"},Ae=re({...Be,setup(r){const b=u(1),w=u(5),z=u(0),I=u(""),h=u(!1),C=u(!1),q=u(),$=ke(),E=u(!1),k=u(!1),D=u([]),R=u([]),x=u(),d=S({id:0,username:"",name:"",password:""}),n=S({userId:0,username:"",allRoleInfoList:[],selectedRoleIdList:[]}),G=async()=>{(await ze({userId:n.userId,roleIdList:n.selectedRoleIdList})).code===200&&(await g(),U.success({message:"分配角色成功！"}),C.value=!1,window.location.reload())},H=async o=>{const e=await Se(o.id);e.code===200&&(n.userId=o.id,n.selectedRoleIdList=[],e.data.assignRoles.forEach((s,p)=>{n.selectedRoleIdList[p]=s.id}),n.allRoleInfoList=e.data.allRolesList,n.username=o.name,C.value=!0)},J=()=>{var o;(o=x.value)==null||o.clearValidate(),Object.assign(d,{id:0,username:"",name:"",password:""})},N=o=>{o&&Object.assign(d,{id:o.id,username:o.username,name:o.name}),h.value=!0},K=async()=>{var o;try{await((o=x.value)==null?void 0:o.validate()),(await Le(d)).code===200&&(await g(),U.success({message:d.id?"修改成功！":"添加成功！"}),h.value=!1)}catch(e){console.error(e)}},Q=S({username:[{required:!0,validator:(o,e,s)=>{if(e){if(/^\d+$/.test(e))return s(new Error("用户名称不能使用纯数字！"));if((e==null?void 0:e.length)<5)return s(new Error("名字必须大于5个字符！"));s()}else return s(new Error("此项为必填项！"))},trigger:"blur"}],name:[{required:!0,validator:(o,e,s)=>{if(e){if((e==null?void 0:e.length)<5)return s(new Error("名字必须大于5个字符！"));s()}else return s(new Error("此项为必填项！"))},trigger:"blur"}],password:[{required:!0,validator:(o,e,s)=>{if(e){if(e.length<6)return s(new Error("密码必须大于6个字符！"));s()}else return s(new Error("此项为必填项！"))},trigger:"blur"}]}),W=async()=>{(await $e(R.value)).code===200&&(await g(),U.success({message:"删除成功！"}))},X=o=>{o.length===0&&(R.value=[]),o.forEach(e=>{R.value.push(e.id)})},Y=async o=>{(await qe(o)).code===200&&(await g(),U.success({message:"删除成功！"}))};de(()=>{g()});async function g(){const o=await xe(b.value,w.value,I.value);o.code===200&&(D.value=o.data.records,z.value=o.data.total)}const Z=()=>{g(),q.value.clear()},ee=()=>{b.value=1,g()},le=o=>{o?n.allRoleInfoList.forEach((e,s)=>{n.selectedRoleIdList[s]=e.id}):n.selectedRoleIdList=[],k.value=!1},ae=o=>{const e=o.length;E.value=e===n.allRoleInfoList.length,k.value=e>0&&e<n.allRoleInfoList.length};return(o,e)=>{const s=ce,p=fe,m=ge,L=_e,B=ve,c=be,te=we,oe=he,se=Ce,A=ye,F=Ve,ne=Ie,y=ie("permission-btn");return f(),O("div",null,[l(B,{style:{height:"80px"}},{default:t(()=>[l(L,{class:"search-bar",inline:""},{default:t(()=>[l(p,{label:"用户搜索"},{default:t(()=>[l(s,{ref_key:"searchInpRef",ref:q,modelValue:I.value,"onUpdate:modelValue":e[0]||(e[0]=a=>I.value=a),placeholder:"请输入要搜索的用户名"},null,8,["modelValue"])]),_:1}),l(p,null,{default:t(()=>[l(m,{onClick:Z,disabled:!I.value.length,type:"primary"},{default:t(()=>[i(" 搜索 ")]),_:1},8,["disabled"]),l(m,{onClick:e[1]||(e[1]=a=>T($).isRefresh=!T($).isRefresh)},{default:t(()=>[i(" 重置 ")]),_:1})]),_:1})]),_:1})]),_:1}),l(B,{style:{margin:"32px 0"}},{default:t(()=>[V((f(),_(m,{onClick:N,type:"primary"},{default:t(()=>[i(" 添加用户 ")]),_:1})),[[y,"btn.User.add"]]),V((f(),_(m,{onClick:W,disabled:R.value.length===0,type:"danger"},{default:t(()=>[i(" 批量删除 ")]),_:1},8,["disabled"])),[[y,"btn.User.remove"]]),l(oe,{onSelectionChange:X,style:{margin:"10px 0"},border:"",data:D.value},{default:t(()=>[l(c,{type:"selection",align:"center"}),l(c,{label:"#",align:"center",type:"index"}),l(c,{label:"id",align:"center",prop:"id"}),l(c,{label:"用户名字",align:"center",prop:"username","show-overflow-tooltip":""}),l(c,{label:"用户昵称",align:"center",prop:"name","show-overflow-tooltip":""}),l(c,{label:"用户角色",align:"center",prop:"roleName","show-overflow-tooltip":""}),l(c,{label:"创建时间",align:"center",prop:"createTime","show-overflow-tooltip":""}),l(c,{label:"更新时间",align:"center",prop:"updateTime","show-overflow-tooltip":""}),l(c,{label:"操作",width:"300px",align:"center"},{default:t(({row:a})=>[V((f(),_(m,{size:"small",icon:"User",onClick:P=>H(a)},{default:t(()=>[i(" 分配角色 ")]),_:2},1032,["onClick"])),[[y,"btn.User.assgin"]]),V((f(),_(m,{onClick:P=>N(a),type:"primary",size:"small",icon:"Edit"},{default:t(()=>[i(" 编辑 ")]),_:2},1032,["onClick"])),[[y,"btn.User.update"]]),l(te,{title:`你确定删除${a.username}`,width:"260px",onConfirm:P=>Y(a.id)},{reference:t(()=>[V((f(),_(m,{type:"danger",size:"small",icon:"Delete"},{default:t(()=>[i(" 删除 ")]),_:1})),[[y,"btn.User.remove"]])]),_:2},1032,["title","onConfirm"])]),_:1})]),_:1},8,["data"]),l(se,{"current-page":b.value,"onUpdate:currentPage":e[2]||(e[2]=a=>b.value=a),"page-size":w.value,"onUpdate:pageSize":e[3]||(e[3]=a=>w.value=a),"page-sizes":[5,7,9,11],background:"",layout:"prev, pager, next, jumper, ->, sizes, total",total:z.value,onSizeChange:ee,onCurrentChange:g},null,8,["current-page","page-size","total"])]),_:1}),l(A,{modelValue:h.value,"onUpdate:modelValue":e[8]||(e[8]=a=>h.value=a),onClose:J},{header:t(()=>[M("h1",null,j(d.id?"编辑用户":"添加用户"),1)]),default:t(()=>[l(L,{ref_key:"userFormRef",ref:x,model:d,rules:Q},{default:t(()=>[l(p,{prop:"username",label:"用户姓名"},{default:t(()=>[l(s,{modelValue:d.username,"onUpdate:modelValue":e[4]||(e[4]=a=>d.username=a),placeholder:"请输入用户姓名"},null,8,["modelValue"])]),_:1}),l(p,{prop:"name",label:"用户昵称"},{default:t(()=>[l(s,{modelValue:d.name,"onUpdate:modelValue":e[5]||(e[5]=a=>d.name=a),placeholder:"请输入用户昵称"},null,8,["modelValue"])]),_:1}),d.id?ue("",!0):(f(),_(p,{key:0,prop:"password",label:"用户密码"},{default:t(()=>[l(s,{modelValue:d.password,"onUpdate:modelValue":e[6]||(e[6]=a=>d.password=a),placeholder:"请输入用户密码"},null,8,["modelValue"])]),_:1}))]),_:1},8,["model","rules"])]),footer:t(()=>[l(m,{onClick:e[7]||(e[7]=a=>h.value=!1)},{default:t(()=>[i("取消")]),_:1}),l(m,{onClick:K,type:"primary"},{default:t(()=>[i("确定")]),_:1})]),_:1},8,["modelValue"]),l(A,{modelValue:C.value,"onUpdate:modelValue":e[14]||(e[14]=a=>C.value=a)},{header:t(()=>[Ne]),default:t(()=>[l(L,{modelValue:n,"onUpdate:modelValue":e[12]||(e[12]=a=>n=a)},{default:t(()=>[l(p,{label:"用户姓名"},{default:t(()=>[l(s,{modelValue:n.username,"onUpdate:modelValue":e[9]||(e[9]=a=>n.username=a),placeholder:"请输入用户姓名",disabled:""},null,8,["modelValue"])]),_:1}),l(p,{label:"职位列表"},{default:t(()=>[l(F,{modelValue:E.value,"onUpdate:modelValue":e[10]||(e[10]=a=>E.value=a),indeterminate:k.value,onChange:le,style:{"margin-right":"32px"}},{default:t(()=>[i(" 全选 ")]),_:1},8,["modelValue","indeterminate"]),l(ne,{modelValue:n.selectedRoleIdList,"onUpdate:modelValue":e[11]||(e[11]=a=>n.selectedRoleIdList=a),onChange:ae},{default:t(()=>[(f(!0),O(me,null,pe(n.allRoleInfoList,a=>(f(),_(F,{key:a.id,label:a.id},{default:t(()=>[i(j(a.roleName),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["modelValue"])]),footer:t(()=>[l(m,{onClick:e[13]||(e[13]=a=>C.value=!1)},{default:t(()=>[i("取消")]),_:1}),l(m,{onClick:G,type:"primary"},{default:t(()=>[i("确定")]),_:1})]),_:1},8,["modelValue"])])}}});const el=Ee(Ae,[["__scopeId","data-v-180e4465"]]);export{el as default};
