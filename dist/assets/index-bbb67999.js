/* empty css             *//* empty css                  *//* empty css                   *//* empty css                        *//* empty css                  *//* empty css                      *//* empty css                 *//* empty css                  *//* empty css                   *//* empty css                *//* empty css                     */import{u as le}from"./setting-f523d10d.js";import{ad as f,d as te,a as r,r as A,P as oe,ae as ne,o as y,e as se,f as a,w as l,i as d,g as O,M as k,z as w,v as B,a7 as re,af as N,m as ie,n as de,p as ce,q as ue,aa as pe,ag as me,ah as fe,ai as _e,aj as ve,an as ge,ao as ye,ak as he,s as Ce,t as be,_ as ke}from"./index-88a49f2b.js";const we=(n,c,_)=>f.get(`/admin/acl/role/${n}/${c}/?roleName=${_}`),Re=n=>n.id?f.put("/admin/acl/role/update",n):f.post("/admin/acl/role/save",n),Ee=n=>f.get("/admin/acl/permission/toAssign/"+n),xe=(n,c)=>f.post(`/admin/acl/permission/doAssign/?roleId=${n}&permissionId=${c}`),Ne=n=>f.delete("/admin/acl/role/remove/"+n),Ve=n=>(Ce("data-v-060daa2e"),n=n(),be(),n),Ie={class:"dialog-footer"},ze=Ve(()=>B("h1",null,"分配权限",-1)),$e={name:"role"},Pe=te({...$e,setup(n){const c=r(1),_=r(10),V=r(0),h=r(""),v=r(!1),g=r(!1),I=le(),z=r(),u=A({id:0,roleName:""}),R=r([]),$=r([]),E=r([]),P=r(0),x=r(),j=async()=>{const o=x.value.getCheckedKeys(),e=x.value.getHalfCheckedKeys(),s=o.concat(e);(await xe(P.value,s)).code===200&&(g.value=!1,await re(()=>{N({type:"success",message:"分配成功！"})}),window.location.reload())},H=async o=>{const e=await Ee(o.id);e.code===200&&(P.value=o.id,R.value=e.data,E.value=[],S(R.value,E.value),g.value=!0)},S=(o,e)=>{o.forEach(s=>{s.select&&s.level===4&&e.push(s.id),s.children&&s.children.length&&S(s.children,e)})},L=()=>{Object.assign(u,{id:0,roleName:""})},U=o=>{o&&Object.assign(u,o),v.value=!0},F=async()=>{(await Re(u)).code===200&&(await p(),v.value=!1,N.success({message:u.id?"编辑成功":"添加成功"}))},K=A({roleName:[{required:!0,validator:(o,e,s)=>{e?e.length<2?s(new Error("角色名称不得低于2个字符")):s():s(new Error("此项为必填项"))},trigger:"blur"}]}),M=async o=>{(await Ne(o)).code===200&&(await p(),N.success({message:"删除成功！"}))},G=()=>{c.value=1,p()},J=()=>{p(),z.value.clear()};oe(()=>{p()});async function p(){const o=await we(c.value,_.value,h.value);o.code===200&&($.value=o.data.records,V.value=o.data.total)}const Q={children:"children",label:"name"};return(o,e)=>{const s=ie,C=de,i=ce,q=ue,D=pe,m=me,W=fe,X=_e,Y=ve,Z=ge,ee=ye,ae=he,b=ne("permission-btn");return y(),se("div",null,[a(D,{style:{height:"80px"}},{default:l(()=>[a(q,{class:"search-bar",inline:""},{default:l(()=>[a(C,{label:"职位搜索"},{default:l(()=>[a(s,{ref_key:"searchInpRef",ref:z,modelValue:h.value,"onUpdate:modelValue":e[0]||(e[0]=t=>h.value=t),placeholder:"请输入要搜索的职位"},null,8,["modelValue"])]),_:1}),a(C,null,{default:l(()=>[a(i,{onClick:J,disabled:!h.value.length,type:"primary"},{default:l(()=>[d(" 搜索 ")]),_:1},8,["disabled"]),a(i,{onClick:e[1]||(e[1]=t=>O(I).isRefresh=!O(I).isRefresh)},{default:l(()=>[d(" 重置 ")]),_:1})]),_:1})]),_:1})]),_:1}),a(D,{style:{margin:"32px 0"}},{default:l(()=>[k((y(),w(i,{onClick:U,type:"primary"},{default:l(()=>[d(" 添加职位 ")]),_:1})),[[b,"btn.Role.add"]]),a(X,{style:{margin:"32px 0"},border:"",data:$.value},{default:l(()=>[a(m,{label:"#",align:"center",type:"index"}),a(m,{label:"id",align:"center",prop:"id"}),a(m,{label:"职位名称",align:"center",prop:"roleName","show-overflow-tooltip":""}),a(m,{label:"创建时间",align:"center",prop:"createTime","show-overflow-tooltip":""}),a(m,{label:"更新时间",align:"center",prop:"updateTime","show-overflow-tooltip":""}),a(m,{label:"操作",width:"300px",align:"center"},{default:l(({row:t})=>[k((y(),w(i,{size:"small",icon:"User",onClick:T=>H(t)},{default:l(()=>[d(" 分配权限 ")]),_:2},1032,["onClick"])),[[b,"btn.Role.assgin"]]),k((y(),w(i,{type:"primary",size:"small",icon:"Edit",onClick:T=>U(t)},{default:l(()=>[d(" 编辑 ")]),_:2},1032,["onClick"])),[[b,"btn.Role.update"]]),a(W,{title:`你确定删除${t.roleName}`,width:"260px",onConfirm:T=>M(t.id)},{reference:l(()=>[k((y(),w(i,{type:"danger",size:"small",icon:"Delete"},{default:l(()=>[d(" 删除 ")]),_:1})),[[b,"btn.Role.remove"]])]),_:2},1032,["title","onConfirm"])]),_:1})]),_:1},8,["data"]),a(Y,{"current-page":c.value,"onUpdate:currentPage":e[2]||(e[2]=t=>c.value=t),"page-size":_.value,"onUpdate:pageSize":e[3]||(e[3]=t=>_.value=t),"page-sizes":[10,20,30,40],background:"",layout:"prev, pager, next, jumper, ->, sizes, total",total:V.value,onSizeChange:G,onCurrentChange:p},null,8,["current-page","page-size","total"])]),_:1}),a(Z,{onClose:L,modelValue:v.value,"onUpdate:modelValue":e[6]||(e[6]=t=>v.value=t),title:u.id?"编辑职位":"增加职位"},{footer:l(()=>[B("span",Ie,[a(i,{onClick:e[5]||(e[5]=t=>v.value=!1)},{default:l(()=>[d("取消")]),_:1}),a(i,{type:"primary",onClick:F},{default:l(()=>[d(" 确定 ")]),_:1})])]),default:l(()=>[a(q,{model:u,rules:K},{default:l(()=>[a(C,{prop:"roleName",label:"职位名称","label-width":140},{default:l(()=>[a(s,{modelValue:u.roleName,"onUpdate:modelValue":e[4]||(e[4]=t=>u.roleName=t),placeholder:"请输入职位名称"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"]),a(ae,{modelValue:g.value,"onUpdate:modelValue":e[8]||(e[8]=t=>g.value=t)},{header:l(()=>[ze]),default:l(()=>[a(ee,{ref_key:"treeRef",ref:x,data:R.value,"show-checkbox":"","node-key":"id",props:Q,"default-checked-keys":E.value,"default-expand-all":""},null,8,["data","default-checked-keys"])]),footer:l(()=>[a(i,{onClick:e[7]||(e[7]=t=>g.value=!1)},{default:l(()=>[d("取消")]),_:1}),a(i,{onClick:j,type:"primary"},{default:l(()=>[d(" 确定 ")]),_:1})]),_:1},8,["modelValue"])])}}});const Ge=ke(Pe,[["__scopeId","data-v-060daa2e"]]);export{Ge as default};
