/* empty css             *//* empty css                *//* empty css                     *//* empty css                 *//* empty css                        *//* empty css                   */import{d as Q,a as b,r as k,Q as K,ac as W,ae as X,o as p,e as V,f as t,at as $,w as r,M as _,v as w,z as E,g as C,ar as F,i as y,F as Y,y as Z,x as L,N as T,af as m,a7 as h,p as ee,ag as te,au as ae,ah as le,ai as se,m as re,n as oe,q as ne,aa as ie}from"./index-bf8d9e9a.js";import{u as ce,r as de,C as ue,a as me,b as pe}from"./index-14b04668.js";/* empty css                  */const fe={class:"table-scene"},_e={class:"add-update-scene"},ye=["onClick"],ge={name:"attribute"},Ae=Q({...ge,setup(ve){const u=b(0),n=ce(),g=k([]),A=b(),s=k({attrName:"",attrValueList:[],categoryId:0,categoryLevel:3});let c=b([]);K(()=>n.c3Id,async()=>{try{await I()}catch{n.c3Id=""}});const I=async()=>{if(!n.c1Id||!n.c2Id||!n.c3Id)return;const a=await de(n.c1Id,n.c2Id,n.c3Id);a.code===200&&(c.value=a.data)},z=()=>{Object.assign(s,{attrName:"",attrValueList:[],categoryId:n.c3Id,categoryLevel:3}),u.value=1},D=async()=>{try{await x.value.validate(),(await me(s)).code===200?(await I(),m({type:"success",message:s.id?"修改成功！":"添加成功！"}),u.value=0):m({type:"error",message:s.id?"修改失败！":"添加失败！"})}catch(a){m({type:"error",message:a.attrName[0].message})}},M=a=>{Object.assign(s,JSON.parse(JSON.stringify(a))),u.value=1,h(()=>{var l;(l=A.value)==null||l.focus()})},S=(a,l)=>{a.isEditMode=!0,h(()=>{var o;(o=g[l])==null||o.focus()})},q=(a,l)=>{let o=a.valueName;o.trim()===""&&(m({type:"error",message:"属性值不能为空!"}),s.attrValueList.splice(l,1)),s.attrValueList.find(v=>{if(v!==a)return v.valueName===o})&&(m({type:"error",message:"属性值不能重复!"}),s.attrValueList.splice(l,1)),a.isEditMode=!1},O=()=>{s.attrValueList.push({valueName:"",isEditMode:!0}),h(()=>{var a;(a=g[g.length-1])==null||a.focus()})},U=async a=>{(await pe(a)).code===200?(await I(),m({type:"success",message:"删除成功"})):m({type:"error",message:"删除失败"})},x=b(),j=k({attrName:[{required:!0,message:"属性名称不能为空！",trigger:"blur"}]});return W(()=>{n.$reset()}),(a,l)=>{const o=ee,d=te,v=ae,H=le,R=se,B=re,J=oe,G=ne,P=ie,N=X("permission-btn");return p(),V("div",null,[t(ue,{scene:u.value,onC1Change:l[0]||(l[0]=e=>$(c)?c.value=[]:c=[]),onC2Change:l[1]||(l[1]=e=>$(c)?c.value=[]:c=[])},null,8,["scene"]),t(P,{class:"attr",style:{"margin-top":"32px"}},{default:r(()=>[_(w("div",fe,[_((p(),E(o,{type:"primary",icon:C(F),onClick:z,disabled:!C(n).c3Id},{default:r(()=>[y(" 添加平台属性 ")]),_:1},8,["icon","disabled"])),[[N,"btn.Attr.add"]]),t(R,{style:{margin:"16px 0"},data:C(c),border:""},{default:r(()=>[t(d,{type:"index",label:"序号",width:"80",align:"center"}),t(d,{prop:"attrName",label:"属性名称"}),t(d,{label:"属性值名称"},{default:r(({row:e})=>[(p(!0),V(Y,null,Z(e.attrValueList,i=>(p(),E(v,{style:{margin:"3px"},key:i.id},{default:r(()=>[y(L(i.valueName),1)]),_:2},1024))),128))]),_:1}),t(d,{label:"属性操作"},{default:r(({row:e})=>[_(t(o,{type:"primary",size:"small",icon:"Edit",onClick:i=>M(e)},null,8,["onClick"]),[[N,"btn.Attr.update"]]),t(H,{title:`确定要删除“${e.attrName}”吗?`,width:"250px",icon:"delete",onConfirm:i=>U(e.id)},{reference:r(()=>[_(t(o,{type:"danger",size:"small",icon:"Delete"},null,512),[[N,"btn.Attr.remove"]])]),_:2},1032,["title","onConfirm"])]),_:1})]),_:1},8,["data"])],512),[[T,u.value===0]]),_(w("div",_e,[t(G,{ref_key:"attrFormRuleRef",ref:x,model:s,rules:j},{default:r(()=>[t(J,{prop:"attrName",label:"属性名称"},{default:r(()=>[t(B,{style:{width:"180px"},ref:e=>A.value=e,placeholder:"请输入属性名称",modelValue:s.attrName,"onUpdate:modelValue":l[2]||(l[2]=e=>s.attrName=e),clearable:""},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"]),t(o,{type:"primary",icon:C(F),onClick:O,style:{margin:"12px 0"}},{default:r(()=>[y(" 添加属性值 ")]),_:1},8,["icon"]),t(R,{style:{margin:"16px 0"},data:s.attrValueList,border:""},{default:r(()=>[t(d,{type:"index",label:"序号",width:"80",align:"center"}),t(d,{label:"属性值名称"},{default:r(({row:e,$index:i})=>[e.isEditMode?(p(),E(B,{key:0,placeholder:"请输入属性值名称",modelValue:e.valueName,"onUpdate:modelValue":f=>e.valueName=f,onBlur:f=>q(e,i),ref:f=>g[i]=f,clearable:""},null,8,["modelValue","onUpdate:modelValue","onBlur"])):(p(),V("div",{key:1,onClick:f=>S(e,i)},L(e.valueName),9,ye))]),_:1}),t(d,{label:"属性值操作"},{default:r(({$index:e})=>[t(o,{type:"danger",size:"small",icon:"Delete",onClick:i=>s.attrValueList.splice(e,1)},null,8,["onClick"])]),_:1})]),_:1},8,["data"]),t(o,{type:"primary",size:"default",onClick:D},{default:r(()=>[y(L(s.id?"修改":"添加"),1)]),_:1}),t(o,{size:"default",onClick:l[3]||(l[3]=e=>u.value=0)},{default:r(()=>[y("取消")]),_:1})],512),[[T,u.value===1]])]),_:1})])}}});export{Ae as default};
