/* empty css             *//* empty css                  *//* empty css                   *//* empty css                *//* empty css                      *//* empty css                 *//* empty css                        *//* empty css                  *//* empty css                   */import{ad as F,d as W,a as d,r as ne,M as z,N as X,o as p,z as U,w as a,f as e,e as w,F as q,y as H,v as Y,i as B,af as E,m as se,n as oe,av as ue,aw as re,q as ie,ag as Z,p as ee,ai as te,aa as ae,aq as Se,g as j,ar as ye,x as ke,a7 as Ie,C as Ve,as as Ue,an as de,au as he,Q as Ce,ac as Le,ae as Ae,ah as Pe,aj as Ne}from"./index-bf8d9e9a.js";import{u as le,r as $e,C as we}from"./index-14b04668.js";/* empty css                     */import{r as xe,a as De}from"./index-26edd68c.js";/* empty css                    *//* empty css                */const ze=(v,h,I)=>F.get(`/admin/product/${v}/${h}?category3Id=${I}`),Ee=()=>F.get("/admin/product/baseSaleAttrList"),Be=()=>F.get("/admin/product/baseTrademark/getTrademarkList"),ce=v=>F.get(`/admin/product/spuImageList/${v}`),pe=v=>F.get(`/admin/product/spuSaleAttrList/${v}`),Fe=v=>v.id?F.post("/admin/product/updateSpuInfo",v):F.post("/admin/product/saveSpuInfo",v),qe=v=>F.delete(`/admin/product/deleteSpu/${v}`),He=["src"],Me={name:"skuForm"},Te=W({...Me,props:["scene"],emits:["cancel","save"],setup(v,{expose:h,emit:I}){const C=le(),P=d([]),m=d([]),N=d([]),i=ne({category3Id:0,price:"",skuDefaultImg:"",skuDesc:"",skuName:"",spuId:0,tmId:0,weight:"",skuAttrValueList:[],skuSaleAttrValueList:[]}),$=d(),b=new Map,y=(S,s)=>{b.set(S.id,s)},M=S=>{var s,_;(s=$.value)==null||s.clearSelection(),(_=$.value)==null||_.toggleRowSelection(S,!0),i.skuDefaultImg=S.imgUrl},g=async()=>{b.forEach((s,_)=>{var u;(u=i.skuAttrValueList)==null||u.push({attrId:_,valueId:s})}),i.skuSaleAttrValueList=m.value.reduce((s,_)=>{if(_.hashMapString){const[u,L]=_.hashMapString.split(":");s.push({saleAttrId:u,saleAttrValueId:L})}return s},[]),(await xe(i)).code===200?(E({type:"success",message:"添加成功！"}),I("save")):E({type:"error",message:"添加失败！"})};return h({initSkuFormData:async S=>{Object.assign(i,{category3Id:0,price:"",skuDefaultImg:"",skuDesc:"",skuName:"",spuId:0,tmId:0,weight:"",skuAttrValueList:[],skuSaleAttrValueList:[]}),b.clear();try{const[s,_,u]=await Promise.all([$e(C.c1Id,C.c2Id,C.c3Id),pe(S),ce(S)]);P.value=s.data,m.value=_.data,N.value=u.data}catch(s){console.error(s)}}}),(S,s)=>{const _=se,u=oe,L=ue,T=re,c=ie,r=Z,V=ee,k=te,l=ae;return z((p(),U(l,null,{default:a(()=>[e(c,{"label-width":"100px"},{default:a(()=>[e(u,{label:"SKU名称"},{default:a(()=>[e(_,{modelValue:i.skuName,"onUpdate:modelValue":s[0]||(s[0]=t=>i.skuName=t),placeholder:"请输入SKU名称"},null,8,["modelValue"])]),_:1}),e(u,{label:"价格(元)"},{default:a(()=>[e(_,{modelValue:i.price,"onUpdate:modelValue":s[1]||(s[1]=t=>i.price=t),placeholder:"请输入价格"},null,8,["modelValue"])]),_:1}),e(u,{label:"重量(g)"},{default:a(()=>[e(_,{modelValue:i.weight,"onUpdate:modelValue":s[2]||(s[2]=t=>i.weight=t),placeholder:"请输入重量"},null,8,["modelValue"])]),_:1}),e(u,{label:"SKU描述"},{default:a(()=>[e(_,{modelValue:i.skuDesc,"onUpdate:modelValue":s[3]||(s[3]=t=>i.skuDesc=t),type:"textarea",placeholder:"请输入SKU描述"},null,8,["modelValue"])]),_:1}),e(u,{label:"平台属性"},{default:a(()=>[e(c,{inline:"","label-width":"80px","label-position":"right"},{default:a(()=>[(p(!0),w(q,null,H(P.value,t=>(p(),U(u,{key:t.id,label:t.attrName,style:{"margin-bottom":"12px"}},{default:a(()=>[e(T,{onChange:o=>y(t,o),modelValue:t.valueNameId,"onUpdate:modelValue":o=>t.valueNameId=o,placeholder:"请选择"},{default:a(()=>[(p(!0),w(q,null,H(t.attrValueList,o=>(p(),U(L,{label:o.valueName,value:o.id,key:o.id},null,8,["label","value"]))),128))]),_:2},1032,["onChange","modelValue","onUpdate:modelValue"])]),_:2},1032,["label"]))),128))]),_:1})]),_:1}),e(u,{label:"销售属性"},{default:a(()=>[e(c,{inline:"","label-width":"80px","label-position":"right"},{default:a(()=>[(p(!0),w(q,null,H(m.value,t=>(p(),U(u,{key:t.id,label:t.saleAttrName,style:{"margin-bottom":"12px"}},{default:a(()=>[e(T,{modelValue:t.hashMapString,"onUpdate:modelValue":o=>t.hashMapString=o,placeholder:"请选择"},{default:a(()=>[(p(!0),w(q,null,H(t.spuSaleAttrValueList,o=>(p(),U(L,{label:o.saleAttrValueName,value:`${t.id}:${o.id}`,key:o.id},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"]))),128))]),_:1})]),_:1}),e(u,{label:"图片名称"},{default:a(()=>[e(k,{ref_key:"imgTableRef",ref:$,data:N.value,style:{width:"100%"},border:""},{default:a(()=>[e(r,{type:"selection",width:"55"}),e(r,{label:"图片",width:"180"},{default:a(({row:t})=>[Y("img",{src:t.imgUrl,alt:"图片丢失了",style:{width:"100px",height:"100px","object-fit":"contain"}},null,8,He)]),_:1}),e(r,{prop:"imgName",label:"名称"}),e(r,{label:"操作"},{default:a(({row:t})=>[e(V,{onClick:o=>M(t),type:"primary",size:"small"},{default:a(()=>[B(" 设置默认 ")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1})]),_:1}),e(V,{type:"primary",size:"default",onClick:g},{default:a(()=>[B(" 保存 ")]),_:1}),e(V,{size:"default",onClick:s[4]||(s[4]=t=>I("cancel"))},{default:a(()=>[B("取消")]),_:1})]),_:1},512)),[[X,v.scene===1]])}}}),Ke=["src"],Ge={name:"spuForm"},je=W({...Ge,props:["scene"],emits:["cancel","save"],setup(v,{expose:h,emit:I}){const C=le(),P=d(""),m=d(!1),N=d([]),i=d([]),$=d([]),b=d([]),y=d(""),M=d([]),g=ne({tmId:"",spuName:"",description:"",category3Id:0,spuImageList:[],spuSaleAttrList:[]}),R=(l,t)=>{l.code===200&&(t.url=l.data)},S=()=>{c(),I("cancel")},s=(l,t)=>{l.saleAttrValue="",l.isInput=!0,Ie(()=>{var o;(o=M.value[t])==null||o.focus()})},_=l=>{var t;l.saleAttrValue.trim()===""?E({type:"warning",message:"属性值不能为空！"}):(t=l.spuSaleAttrValueList)==null||t.push({baseSaleAttrId:l.baseSaleAttrId,saleAttrValueName:l.saleAttrValue}),l.isInput=!1},u=()=>{const[l,t]=y.value.split(":");b.value.push({baseSaleAttrId:l,saleAttrName:t,spuSaleAttrValueList:[]}),y.value=""};let L=Se(()=>$.value.filter(l=>!b.value.find(o=>Number(o.baseSaleAttrId)===Number(l.id))));const T=async()=>{g.spuImageList=i.value.map(t=>({imgName:t.name,imgUrl:t.url})),g.spuSaleAttrList=b.value,(await Fe(g)).code===200?(await c(),E.success({message:g.id?"修改成功!":"添加成功!"}),I("save")):E.error({message:g.id?"修改失败!":"添加失败!"})},c=async()=>{i.value=[],b.value=[],y.value="",P.value="",Object.assign(g,{id:0,tmId:"",spuName:"",description:"",category3Id:C.c3Id,spuImageList:[],spuSaleAttrList:[]});try{const[l,t]=await Promise.all([Be(),Ee()]);N.value=l.data,$.value=t.data}catch(l){console.error(l)}},r=async l=>{if(await c(),l){Object.assign(g,{id:l.id,tmId:l.tmId,spuName:l.spuName,description:l.description,category3Id:C.c3Id,spuImageList:[],spuSaleAttrList:[]});try{const[t,o]=await Promise.all([ce(l.id),pe(l.id)]);for(const A of t.data)i.value.push({name:A.imgName,url:A.imgUrl});b.value=o.data}catch(t){console.error(t)}}},V=l=>{P.value=l.url,m.value=!0},k=l=>l.type==="images/png"||l.type==="images/jpeg"||l.type==="images/gif"?l.size/1024/1024<5?!0:(E({type:"error",message:"上传图片必须小于5M"}),!1):(E({type:"error",message:"上传图片格式必须为PNG|JPG|GIF"}),!1);return h({initSpuPresetData:r}),(l,t)=>{const o=se,A=oe,O=ue,x=re,f=Ve,K=Ue,me=de,G=ee,J=Z,_e=he,fe=te,ge=ie,ve=ae;return z((p(),U(ve,null,{default:a(()=>[e(ge,{"label-width":"100px"},{default:a(()=>[e(A,{label:"SPU名称"},{default:a(()=>[e(o,{modelValue:g.spuName,"onUpdate:modelValue":t[0]||(t[0]=n=>g.spuName=n),placeholder:"请输入SPU名称"},null,8,["modelValue"])]),_:1}),e(A,{label:"SPU品牌"},{default:a(()=>[e(x,{modelValue:g.tmId,"onUpdate:modelValue":t[1]||(t[1]=n=>g.tmId=n),placeholder:"请选择"},{default:a(()=>[(p(!0),w(q,null,H(N.value,n=>(p(),U(O,{label:n.tmName,value:n.id,key:n.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(A,{label:"SPU描述"},{default:a(()=>[e(o,{modelValue:g.description,"onUpdate:modelValue":t[2]||(t[2]=n=>g.description=n),type:"textarea",placeholder:"请输入SPU描述"},null,8,["modelValue"])]),_:1}),e(A,{label:"SPU图标"},{default:a(()=>[e(K,{"file-list":i.value,"onUpdate:fileList":t[3]||(t[3]=n=>i.value=n),action:"api/admin/product/fileUpload","list-type":"picture-card","on-preview":V,"on-success":R,"before-upload":k},{default:a(()=>[e(f,null,{default:a(()=>[e(j(ye))]),_:1})]),_:1},8,["file-list"]),e(me,{modelValue:m.value,"onUpdate:modelValue":t[4]||(t[4]=n=>m.value=n)},{default:a(()=>[Y("img",{src:P.value,style:{width:"100%",height:"100%"},alt:"图片已丢失"},null,8,Ke)]),_:1},8,["modelValue"])]),_:1}),e(A,{label:"SPU销售属性"},{default:a(()=>[e(x,{modelValue:y.value,"onUpdate:modelValue":t[5]||(t[5]=n=>y.value=n),placeholder:j(L).length?`${j(L).length}个属性可选`:"暂无销售属性可选"},{default:a(()=>[(p(!0),w(q,null,H(j(L),n=>(p(),U(O,{label:n.name,value:`${n.id}:${n.name}`,key:n.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"]),e(G,{onClick:u,type:"primary",icon:"Plus",style:{"margin-left":"16px"},disabled:!y.value},{default:a(()=>[B(" 添加属性 ")]),_:1},8,["disabled"]),e(fe,{data:b.value,style:{margin:"16px 0"},border:""},{default:a(()=>[e(J,{type:"index",width:"55"}),e(J,{prop:"saleAttrName",label:"SPU销售属性名称",width:"140"}),e(J,{label:"SPU销售属性值"},{default:a(({row:n,$index:Q})=>[(p(!0),w(q,null,H(n.spuSaleAttrValueList,(D,be)=>(p(),w("span",{key:D.id},[e(_e,{onClose:Je=>n.spuSaleAttrValueList.splice(be,1),style:{margin:"0 6px 6px 0"},closable:""},{default:a(()=>[B(ke(D.saleAttrValueName),1)]),_:2},1032,["onClose"])]))),128)),n.isInput?(p(),U(o,{key:1,ref:D=>M.value[Q]=D,modelValue:n.saleAttrValue,"onUpdate:modelValue":D=>n.saleAttrValue=D,onBlur:D=>_(n),size:"small",style:{width:"100px"},placeholder:"请输入属性值"},null,8,["modelValue","onUpdate:modelValue","onBlur"])):(p(),U(G,{key:0,onClick:D=>s(n,Q),size:"small",icon:"Plus"},null,8,["onClick"]))]),_:1}),e(J,{label:"操作"},{default:a(({$index:n})=>[e(G,{onClick:Q=>b.value.splice(n,1),type:"danger",size:"small",icon:"Delete"},null,8,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1})]),_:1}),e(G,{type:"primary",size:"default",onClick:T},{default:a(()=>[B(" 保存 ")]),_:1}),e(G,{size:"default",onClick:S},{default:a(()=>[B("取消")]),_:1})]),_:1},512)),[[X,v.scene===2]])}}}),Re=["src"],Oe={name:"spu"},dt=W({...Oe,setup(v){const h=le(),I=d(1),C=d(3),P=d(0),m=d(0),N=d(!1),i=d([]),$=d([]),b=d(),y=d(),M=async()=>{m.value=0,await u()},g=async c=>{(await qe(c)).code===200&&(await u(),E({type:"success",message:"删除成功！"}))},R=async c=>{let r=await De(c);r.code===200&&($.value=r.data),N.value=!0},S=c=>{b.value.initSkuFormData(c),m.value=1},s=c=>{y.value.initSpuPresetData(c),m.value=2},_=()=>{y.value.initSpuPresetData(),m.value=2};Ce(()=>h.c3Id,async()=>{await u()});const u=async()=>{let c=await ze(I.value,C.value,h.c3Id);c.code===200&&(i.value=c.data.records,P.value=c.data.total)},L=async()=>{await u()},T=async()=>{await u()};return Le(()=>{h.$reset()}),(c,r)=>{const V=ee,k=Z,l=Pe,t=te,o=Ne,A=ae,O=de,x=Ae("permission-btn");return p(),w("div",null,[e(we,{scene:m.value},null,8,["scene"]),z(e(A,null,{default:a(()=>[z((p(),U(V,{onClick:_,disabled:!j(h).c3Id,type:"primary",size:"default",icon:"Plus"},{default:a(()=>[B(" 添加SPU ")]),_:1},8,["disabled"])),[[x,"btn.Spu.add"]]),e(t,{style:{margin:"16px 0"},data:i.value,border:""},{default:a(()=>[e(k,{type:"index",label:"序号",width:"80",align:"center"}),e(k,{prop:"spuName",label:"SPU名称"}),e(k,{prop:"description",label:"SPU描述"}),e(k,{label:"SPU操作"},{default:a(({row:f})=>[z(e(V,{size:"small",title:"添加SKU",icon:"Plus",onClick:K=>S(f.id)},null,8,["onClick"]),[[x,"btn.Spu.addsku"]]),z(e(V,{type:"primary",size:"small",title:"修改SPU",icon:"Edit",onClick:K=>s(f)},null,8,["onClick"]),[[x,"btn.Spu.update"]]),z(e(V,{type:"info",icon:"View",title:"查看SKU列表",size:"small",onClick:K=>R(f.id)},null,8,["onClick"]),[[x,"btn.Spu.skus"]]),e(l,{title:`确定要删除“${f.spuName}”吗?`,width:"250px",icon:"delete",onConfirm:K=>g(f.id)},{reference:a(()=>[z(e(V,{type:"danger",size:"small",icon:"Delete"},null,512),[[x,"btn.Spu.delete"]])]),_:2},1032,["title","onConfirm"])]),_:1})]),_:1},8,["data"]),e(o,{"current-page":I.value,"onUpdate:currentPage":r[0]||(r[0]=f=>I.value=f),"page-size":C.value,"onUpdate:pageSize":r[1]||(r[1]=f=>C.value=f),"page-sizes":[3,5,7,9],background:"",layout:"prev, pager, next, jumper, ->, sizes, total",total:P.value,onSizeChange:L,onCurrentChange:T},null,8,["current-page","page-size","total"])]),_:1},512),[[X,m.value===0]]),e(O,{modelValue:N.value,"onUpdate:modelValue":r[2]||(r[2]=f=>N.value=f),title:"SKU列表"},{default:a(()=>[e(t,{data:$.value,border:""},{default:a(()=>[e(k,{property:"skuName",label:"SKU名字"}),e(k,{property:"price",label:"SKU价格"}),e(k,{property:"weight",label:"SKU重量"}),e(k,{label:"SKU图片"},{default:a(({row:f})=>[Y("img",{src:f.skuDefaultImg,alt:"图片丢失了",style:{width:"100px",height:"100px","object-fit":"contain"}},null,8,Re)]),_:1})]),_:1},8,["data"])]),_:1},8,["modelValue"]),e(Te,{ref_key:"skuFormRef",ref:b,scene:m.value,onCancel:r[3]||(r[3]=f=>m.value=0),onSave:r[4]||(r[4]=f=>m.value=0)},null,8,["scene"]),e(je,{ref_key:"spuFormRef",ref:y,scene:m.value,onCancel:r[5]||(r[5]=f=>m.value=0),onSave:M},null,8,["scene"])])}}});export{dt as default};
